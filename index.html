<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sei wie Friedrich â€” Multiplayer</title>

  <!-- âœ… CSS (Datei MUSS styles.css heiÃŸen) -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- âœ… Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">ğŸ‘‘ Sei wie Friedrich â€” Multiplayer</div>
    <div id="statusBar" class="status">Ladeâ€¦</div>
  </header>

  <main class="container">

    <!-- âœ… START -->
    <section id="view-start" class="view">
      <h1>Start</h1>
      <p class="muted">Name eingeben, Raum erstellen oder beitreten.</p>

      <label class="field">
        <span>Dein Name</span>
        <input id="nameInput" type="text" maxlength="18" placeholder="z.B. Leon" />
      </label>

      <div class="row">
        <!-- âœ… ID muss exakt btnCreate heiÃŸen -->
        <button id="btnCreate" class="btn primary" type="button">Raum erstellen</button>
      </div>

      <div class="divider"></div>

      <label class="field">
        <span>Raumcode</span>
        <input id="roomInput" type="text" maxlength="6" placeholder="z.B. A7K2Q9" />
      </label>

      <div class="row">
        <!-- âœ… ID muss exakt btnJoin heiÃŸen -->
        <button id="btnJoin" class="btn" type="button">Raum beitreten</button>
      </div>

      <!-- âœ… Hier schreibt der Debug-/Fehlertext rein -->
      <p id="startError" class="error"></p>
    </section>

    <!-- âœ… LOBBY -->
    <section id="view-lobby" class="view hidden">
      <div class="lobbyHead">
        <h1>Lobby</h1>

        <div class="roomCodeBox">
          <div class="roomCodeLabel">Code</div>
          <div class="roomCodeValue" id="roomCodeText">------</div>
          <button id="btnCopyCode" class="btn tiny" type="button">Kopieren</button>
        </div>
      </div>

      <p class="muted">Warte, bis alle da sind. Der Host kann starten.</p>

      <div class="card">
        <div class="cardTitle">Spieler</div>
        <ul id="playersList" class="list"></ul>
      </div>

      <div class="row">
        <button id="btnStartGame" class="btn primary hidden" type="button">Spiel starten</button>
      </div>

      <p id="lobbyHint" class="muted"></p>
    </section>

    <!-- âœ… QUESTION -->
    <section id="view-question" class="view hidden">
      <h1 id="qTitle">Frage</h1>
      <p id="qPrompt" class="muted"></p>

      <div id="mapWrap" class="hidden">
        <div id="map"></div>
        <p class="muted small">Klicke auf die Karte, um die Pinnnadel zu setzen.</p>
      </div>

      <div id="optionsWrap" class="hidden">
        <div id="options" class="options"></div>
      </div>

      <div class="row">
        <button id="btnSubmit" class="btn primary" type="button">Abgeben</button>
      </div>

      <p id="qError" class="error"></p>
      <p id="qWaiting" class="muted"></p>
    </section>

    <!-- âœ… FEEDBACK -->
    <section id="view-feedback" class="view hidden">
      <h1>Auswertung</h1>

      <div class="scoreRow">
        <div class="ring" id="scoreRing">
          <div class="ringInner">
            <div class="ringValue" id="ringValue">0%</div>
            <div class="ringSmall" id="ringSmall">Gesamt</div>
          </div>
        </div>

        <div class="scoreInfo">
          <div class="delta" id="deltaText">+0%</div>
          <div class="muted" id="deltaMsg"></div>
          <div class="muted small" id="waitingNext"></div>
        </div>
      </div>

      <div class="row">
        <button id="btnNext" class="btn primary" type="button">Weiter</button>
      </div>
    </section>

    <!-- âœ… RESULTS -->
    <section id="view-results" class="view hidden">
      <h1>Ergebnis</h1>
      <p class="muted">Alle sehen jetzt die gleiche Rangliste.</p>

      <div class="card">
        <div class="cardTitle">Rangliste</div>
        <div id="leaderboard" class="leaderboard"></div>
      </div>

      <div class="row">
        <button id="btnRestart" class="btn" type="button">ZurÃ¼ck zum Start</button>
      </div>
    </section>

  </main>

  <!-- âœ… Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- âœ… app.js MUSS als module geladen werden -->
<!-- âœ… Leaflet JS (WICHTIG: @ muss drin sein) -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- âœ… app.js Debug-Loader: zeigt dir den echten Import-Fehler im startError -->
<script type="module">
  const errEl = document.getElementById("startError");
  const statusEl = document.getElementById("statusBar");

  function show(msg) {
    if (errEl) errEl.textContent = msg;
    console.log(msg);
  }

  if (statusEl) statusEl.textContent = "App lÃ¤dtâ€¦";

  import("./app.js")
    .then(() => {
      if (statusEl) statusEl.textContent = "App geladen âœ…";
    })
    .catch((e) => {
      if (statusEl) statusEl.textContent = "Fehler âŒ";
      show("âŒ app.js konnte nicht geladen werden:\n" + (e?.message || e));
      console.error(e);
    });
</script>
</body>
</html>
